<ng-container *ngIf="video">
  <div class="container">
    <div class="mb-3">
      <div class="badge" [ngClass]="video.status | jobStatus: 'style'">
        {{ video.status | jobStatus: "label" }}
      </div>
    </div>
    <h1>{{ video.title }}</h1>
    <p class="page-description">
      Here comes the specific video to be captionized.
    </p>

    <div *ngIf="helpers.isConsultant()" class="row mb-5">
      <div class="col-12 col-md-4">
        <div class="card card-body">
          <div class="row align-items-center">
            <div *ngIf="video.consultant_id === null" class="col">
              <button (click)="startCaptions()" class="btn btn-secondary me-3" [disabled]="video.consultant_id !== null">{{ (video.consultant_id === null) ? 'Start Captions' : 'Captured' }}</button>
            </div>
            <div *ngIf="video.consultant_id !== null" class="col text-end">
              <app-acronym [value]="user | fullName" color="#0099CC" fgColor="#FFFFFF"></app-acronym>
              <small class="text-muted">
                Consultant
              </small>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col col-6">
        <div class="video-placeholder">
          <youtube-player
            #player
            [videoId]="video.video_id"
            [playerVars]="{ controls: 0 }"
            suggestedQuality="highres"
            [height]="365"
            [width]="648"
          >
          </youtube-player>
        </div>
        <div *ngIf="canConsultantUpdateVideo()" class="row mt-2 align-items-center">
          <div class="col-3">
            <button
              *ngIf="!isVideoPlaying"
              (click)="playVideo()"
              type="button"
              class="btn btn-secondary me-2"
            >
              <i class="fas fa-play me-1"></i> Play
            </button>
            <button
              *ngIf="isVideoPlaying"
              (click)="pauseVideo()"
              type="button"
              class="btn btn-secondary"
            >
              <i class="fas fa-pause me-1"></i> Pause
            </button>
          </div>
          <div class="col-9 text-end text-muted">
            <label>
              <input [ngModel]="pauseWhileTyping" name="pauseWhileTyping" (change)="pauseWhileTyping = !pauseWhileTyping" [disabled]="video.consultant_id === null" type="checkbox" title="Pause video while typing"> Pause while typing
            </label>
          </div>
        </div>
      </div>
      <div class="col col-6">
        <span *ngIf="canConsultantUpdateVideo(); else captionsText">
          <form #formSubtitle="ngForm" novalidate>
            <textarea
              [ngModel]="video.subtitles"
              (keyup)="isTyping()"
              [disabled]="(video.consultant_id !== null && user.id !== video.consultant_id && video.status === '2in_progress')"
              name="subtitles"
              cols=""
              rows="14"
              class="form-control"
              required
              placeholder="Escreva a legenda aqui"
            ></textarea>
            <div class="mt-2">
              <div class="row">
                <div class="col-4 offset-md-5">
                  <div class="form-group">
                    <select
                      [ngModel]="video.status"
                      [disabled]="(video.consultant_id !== null && user.id !== video.consultant_id && video.status === '2in_progress')"
                      title="Job status"
                      name="status"
                      class="form-select"
                    >
                      <option *ngFor="let status of helpers.availableJobStatus" [disabled]="['0created','1not_started'].includes(status.id) && helpers.isConsultant()" [value]="status.id">
                        {{ status.label }}
                      </option>
                    </select>
                  </div>
                </div>
                <div class="col-3 d-grid">
                  <button
                    (click)="save(formSubtitle.value)"
                    [disabled]="(video.consultant_id !== null && user.id !== video.consultant_id && video.status === '2in_progress')"
                    type="button"
                    class="btn btn-primary"
                  >
                    Salvar
                  </button>
                </div>
              </div>
            </div>
          </form>
        </span>

        <ng-template #captionsText>
          <div class="mb-3">
            <div class="badge" [ngClass]="video.status | jobStatus: 'style'">
              {{ video.status | jobStatus: "label" }}
            </div>
          </div>
          {{ video.subtitles || 'Nenhuma legenda adicionada ainda' }}
        </ng-template>
      </div>
    </div>

    <div *ngIf="video.consultant_id === null && !helpers.isConsultant()" class="mt-3">
      <button
        (click)="deleteVideo()"
        [disabled]="video.consultant_id !== null || !['0created','1not_started'].includes(video.status)"
        type="button"
        class="btn btn-outline-danger"
      >
        <i class="fas fa-trash mr-2"></i> Remove video
      </button>
    </div>
  </div>
</ng-container>
